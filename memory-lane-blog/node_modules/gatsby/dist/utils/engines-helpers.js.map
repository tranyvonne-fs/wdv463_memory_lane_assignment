{"version":3,"file":"engines-helpers.js","names":["shouldPrintEngineSnapshot","process","env","gatsby_executing_command","generate","shouldGenerateEngines","emitter","on","action","payload","mode","serverData","config","shouldBundleDatastore","store","getState","adapter","excludeDatastoreFromEngineFunction","getCDNObfuscatedPath","path","status","cdnObfuscatedPrefix","getLmdbOnCdnPath","currentTarget","platform","arch","getCurrentPlatformAndTarget","getFunctionsTargetPlatformAndTarget","state","GATSBY_FUNCTIONS_PLATFORM","program","functionsPlatform","GATSBY_FUNCTIONS_ARCH","functionsArch"],"sources":["../../src/utils/engines-helpers.ts"],"sourcesContent":["import { emitter, store } from \"../redux\"\nimport { ICreatePageAction, ISetComponentFeatures } from \"../redux/types\"\n\nexport function shouldPrintEngineSnapshot(): boolean {\n  return process.env.gatsby_executing_command === `build`\n}\n\nlet generate = false\nexport function shouldGenerateEngines(): boolean {\n  return process.env.gatsby_executing_command === `build` && generate\n}\n\nemitter.on(`CREATE_PAGE`, (action: ICreatePageAction) => {\n  if (action.payload.mode && action.payload.mode !== `SSG`) generate = true\n})\nemitter.on(`SET_COMPONENT_FEATURES`, (action: ISetComponentFeatures) => {\n  if (action.payload.serverData) generate = true\n  if (action.payload.config) generate = true\n})\n\nexport function shouldBundleDatastore(): boolean {\n  return !store.getState().adapter.config.excludeDatastoreFromEngineFunction\n}\n\nfunction getCDNObfuscatedPath(path: string): string {\n  return `${store.getState().status.cdnObfuscatedPrefix}-${path}`\n}\n\nexport const getLmdbOnCdnPath = (): string => getCDNObfuscatedPath(`data.mdb`)\n\nexport interface IPlatformAndArch {\n  platform: string\n  arch: string\n}\n\nconst currentTarget: IPlatformAndArch = {\n  platform: process.platform,\n  arch: process.arch,\n}\n\nexport function getCurrentPlatformAndTarget(): IPlatformAndArch {\n  return currentTarget\n}\n\nexport function getFunctionsTargetPlatformAndTarget(): IPlatformAndArch {\n  const state = store.getState()\n\n  return {\n    platform:\n      process.env.GATSBY_FUNCTIONS_PLATFORM ??\n      state.program.functionsPlatform ??\n      state.adapter.config.functionsPlatform ??\n      currentTarget.platform,\n    arch:\n      process.env.GATSBY_FUNCTIONS_ARCH ??\n      state.program.functionsArch ??\n      state.adapter.config.functionsArch ??\n      currentTarget.arch,\n  }\n}\n"],"mappings":";;;;;;;;;AAAA;AAGO,SAASA,yBAAyB,GAAY;EACnD,OAAOC,OAAO,CAACC,GAAG,CAACC,wBAAwB,KAAM,OAAM;AACzD;AAEA,IAAIC,QAAQ,GAAG,KAAK;AACb,SAASC,qBAAqB,GAAY;EAC/C,OAAOJ,OAAO,CAACC,GAAG,CAACC,wBAAwB,KAAM,OAAM,IAAIC,QAAQ;AACrE;AAEAE,cAAO,CAACC,EAAE,CAAE,aAAY,EAAGC,MAAyB,IAAK;EACvD,IAAIA,MAAM,CAACC,OAAO,CAACC,IAAI,IAAIF,MAAM,CAACC,OAAO,CAACC,IAAI,KAAM,KAAI,EAAEN,QAAQ,GAAG,IAAI;AAC3E,CAAC,CAAC;AACFE,cAAO,CAACC,EAAE,CAAE,wBAAuB,EAAGC,MAA6B,IAAK;EACtE,IAAIA,MAAM,CAACC,OAAO,CAACE,UAAU,EAAEP,QAAQ,GAAG,IAAI;EAC9C,IAAII,MAAM,CAACC,OAAO,CAACG,MAAM,EAAER,QAAQ,GAAG,IAAI;AAC5C,CAAC,CAAC;AAEK,SAASS,qBAAqB,GAAY;EAC/C,OAAO,CAACC,YAAK,CAACC,QAAQ,EAAE,CAACC,OAAO,CAACJ,MAAM,CAACK,kCAAkC;AAC5E;AAEA,SAASC,oBAAoB,CAACC,IAAY,EAAU;EAClD,OAAQ,GAAEL,YAAK,CAACC,QAAQ,EAAE,CAACK,MAAM,CAACC,mBAAoB,IAAGF,IAAK,EAAC;AACjE;AAEO,MAAMG,gBAAgB,GAAG,MAAcJ,oBAAoB,CAAE,UAAS,CAAC;AAAA;AAO9E,MAAMK,aAA+B,GAAG;EACtCC,QAAQ,EAAEvB,OAAO,CAACuB,QAAQ;EAC1BC,IAAI,EAAExB,OAAO,CAACwB;AAChB,CAAC;AAEM,SAASC,2BAA2B,GAAqB;EAC9D,OAAOH,aAAa;AACtB;AAEO,SAASI,mCAAmC,GAAqB;EAAA;EACtE,MAAMC,KAAK,GAAGd,YAAK,CAACC,QAAQ,EAAE;EAE9B,OAAO;IACLS,QAAQ,4CACNvB,OAAO,CAACC,GAAG,CAAC2B,yBAAyB,yEACrCD,KAAK,CAACE,OAAO,CAACC,iBAAiB,yCAC/BH,KAAK,CAACZ,OAAO,CAACJ,MAAM,CAACmB,iBAAiB,uCACtCR,aAAa,CAACC,QAAQ;IACxBC,IAAI,8CACFxB,OAAO,CAACC,GAAG,CAAC8B,qBAAqB,2EACjCJ,KAAK,CAACE,OAAO,CAACG,aAAa,yCAC3BL,KAAK,CAACZ,OAAO,CAACJ,MAAM,CAACqB,aAAa,yCAClCV,aAAa,CAACE;EAClB,CAAC;AACH"}