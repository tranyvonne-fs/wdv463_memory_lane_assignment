{"version":3,"file":"start-server.js","names":["startServer","program","app","workerPool","WorkerPool","create","directory","PAGE_RENDERER_PATH","path","join","ROUTES_DIRECTORY","webpackActivity","report","activityTimer","id","start","writeVirtualLoadingIndicatorModule","directoryPath","withBasePath","buildRenderer","doBuildPages","require","createIndexHtml","activity","rendererPath","close","Stage","DevelopHTML","span","err","name","panic","stripIndent","indexHTMLActivity","phantomActivity","pageRenderer","process","env","GATSBY_EXPERIMENTAL_DEV_SSR","initDevWorkerPool","end","devConfig","webpackConfig","Develop","port","parentSpan","compiler","webpack","use","compression","webpackHotMiddleware","log","heartbeat","cors","graphqlEndpoint","graphiqlExplorer","getFragments","fragments","def","store","getState","definitions","values","kind","Kind","FRAGMENT_DEFINITION","push","createGraphqlEndpointHandler","schema","context","withResolverContext","schemaComposer","schemaCustomization","composer","customContext","onOperation","_req","_args","result","errors","map","toJSON","extensions","stack","split","enableRefresh","ENABLE_GATSBY_REFRESH_ENDPOINT","refreshToken","GATSBY_REFRESH_TOKEN","REFRESH_ENDPOINT","refresh","req","pluginName","global","__GATSBY","buildId","uuid","v4","emitter","emit","webhookBody","body","post","express","json","res","params","authorizedRefresh","headers","authorization","status","setHeader","error","isEnabled","get","query","fileName","resolve","cwd","lineNumber","parseInt","launchEditor","isNaN","addImageRoutes","webpackDevMiddlewareInstance","webpackDevMiddleware","publicPath","output","stats","serverSideRender","next","requestedPagePath","pagePath","potentialPagePath","reverseFixedPagePath","page","findPageByPath","serverDataPromise","Promise","pageMode","getPageMode","renderer","componentInstance","getPageChunk","getServerData","catch","pageData","GATSBY_QUERY_ON_DEMAND","getPageDataExperimental","readPageData","statusCode","Error","value","Object","entries","serverData","props","getServerDataError","structuredError","panicOnBuild","sourceMessage","message","matchPath","send","e","emptyResponse","codeFrame","sourcePosition","sourceContent","sourceLine","sourceColumn","sourceEndLine","sourceEndColumn","skipSourceMap","moduleId","absolutePath","compilation","locals","devMiddleware","isFileInsideCompilations","fs","readFileSync","endLineNumber","columnNumber","endColumnNumber","line","column","fileModule","module","modules","moduleIdentifier","chunkGraph","getModuleId","webpackSource","codeGenerationResults","sources","sourceMap","position","findOriginalSourcePositionAndContent","codeFrameColumns","undefined","highlightCode","filePath","readFile","developMiddleware","config","proxy","trailingSlash","configureTrailingSlash","developStatic","index","forEach","prefix","url","proxiedUrl","originalUrl","host","method","pipe","got","stream","decompress","on","response","writeHead","_","sendStatus","apiRunnerNode","deferNodeMutation","pathObj","decodeURI","allowTimedFallback","appendPreloadHeaders","htmlActivity","html","renderResponse","renderDevHTML","skipSsr","prototype","hasOwnProperty","call","htmlComponentRendererPath","filename","source","clientOnlyShell","location","minimalHTML","GATSBY_QUERY_ON_DEMAND_LOADING_INDICATOR","routeLoadingIndicatorRequests","fullUrl","protocol","endsWith","webpackCompilationHash","sendFile","server","ssl","https","Server","http","socket","websocketManager","init","listener","listen","chokidar","watchGlobs","slash","watch","to","webpackWatching","watching"],"sources":["../../src/utils/start-server.ts"],"sourcesContent":["import webpackHotMiddleware from \"@gatsbyjs/webpack-hot-middleware\"\nimport webpackDevMiddleware, { type Watching } from \"webpack-dev-middleware\"\nimport got, { Method } from \"got\"\nimport webpack, { Compilation } from \"webpack\"\nimport express from \"express\"\nimport compression from \"compression\"\nimport { createHandler as createGraphqlEndpointHandler } from \"graphql-http/lib/use/express\"\nimport type { OperationContext } from \"graphql-http\"\nimport graphiqlExplorer from \"gatsby-graphiql-explorer\"\nimport { FragmentDefinitionNode, GraphQLError, Kind } from \"graphql\"\nimport { slash, uuid } from \"gatsby-core-utils\"\nimport http from \"http\"\nimport https from \"https\"\nimport cors from \"cors\"\nimport launchEditor from \"react-dev-utils/launchEditor\"\nimport { codeFrameColumns } from \"@babel/code-frame\"\nimport * as fs from \"fs-extra\"\n\nimport { withBasePath } from \"../utils/path\"\nimport webpackConfig from \"../utils/webpack.config\"\nimport { store, emitter } from \"../redux\"\nimport report from \"gatsby-cli/lib/reporter\"\nimport * as WorkerPool from \"../utils/worker/pool\"\n\nimport { developStatic } from \"../commands/develop-static\"\nimport withResolverContext from \"../schema/context\"\nimport { websocketManager, WebsocketManager } from \"../utils/websocket-manager\"\nimport {\n  reverseFixedPagePath,\n  readPageData,\n  IPageDataWithQueryResult,\n} from \"./page-data\"\nimport { getPageData as getPageDataExperimental } from \"./get-page-data\"\nimport { findPageByPath } from \"./find-page-by-path\"\nimport apiRunnerNode from \"../utils/api-runner-node\"\nimport * as path from \"path\"\n\nimport { Stage, IProgram } from \"../commands/types\"\nimport { findOriginalSourcePositionAndContent } from \"./stack-trace-utils\"\nimport { appendPreloadHeaders } from \"./develop-preload-headers\"\nimport {\n  routeLoadingIndicatorRequests,\n  writeVirtualLoadingIndicatorModule,\n} from \"./loading-indicator\"\nimport { renderDevHTML } from \"./dev-ssr/render-dev-html\"\nimport { getServerData, IServerData } from \"./get-server-data\"\nimport { ROUTES_DIRECTORY } from \"../constants\"\nimport { getPageMode } from \"./page-mode\"\nimport { configureTrailingSlash } from \"./express-middlewares\"\nimport type { Express } from \"express\"\nimport { addImageRoutes } from \"gatsby-plugin-utils/polyfill-remote-file\"\nimport { isFileInsideCompilations } from \"./webpack/utils/is-file-inside-compilations\"\n\ntype ActivityTracker = any // TODO: Replace this with proper type once reporter is typed\n\nexport type WebpackWatching = NonNullable<Watching>\n\ninterface IServer {\n  compiler: webpack.Compiler\n  listener: http.Server | https.Server\n  webpackActivity: ActivityTracker\n  websocketManager: WebsocketManager\n  workerPool: WorkerPool.GatsbyWorkerPool\n  webpackWatching: WebpackWatching\n}\n\nexport async function startServer(\n  program: IProgram,\n  app: Express,\n  workerPool: WorkerPool.GatsbyWorkerPool = WorkerPool.create()\n): Promise<IServer> {\n  const directory = program.directory\n  const PAGE_RENDERER_PATH = path.join(\n    program.directory,\n    ROUTES_DIRECTORY,\n    `render-page.js`\n  )\n\n  const webpackActivity = report.activityTimer(`Building development bundle`, {\n    id: `webpack-develop`,\n  })\n  webpackActivity.start()\n\n  // loading indicator\n  // write virtual module always to not fail webpack compilation, but only add express route handlers when\n  // query on demand is enabled and loading indicator is not disabled\n  writeVirtualLoadingIndicatorModule()\n\n  // Remove the following when merging GATSBY_EXPERIMENTAL_DEV_SSR\n  const directoryPath = withBasePath(directory)\n  const { buildRenderer, doBuildPages } = require(`../commands/build-html`)\n  const createIndexHtml = async (activity: ActivityTracker): Promise<void> => {\n    try {\n      const { rendererPath, close } = await buildRenderer(\n        program,\n        Stage.DevelopHTML,\n        activity.span\n      )\n      await doBuildPages(\n        rendererPath,\n        [`/`],\n        activity,\n        workerPool,\n        Stage.DevelopHTML\n      )\n      // close the compiler\n      await close()\n    } catch (err) {\n      if (err.name !== `WebpackError`) {\n        report.panic(err)\n        return\n      }\n      report.panic(\n        report.stripIndent`\n          There was an error compiling the html.js component for the development server.\n          See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html\n        `,\n        err\n      )\n    }\n  }\n  const indexHTMLActivity = report.phantomActivity(`building index.html`, {})\n\n  let pageRenderer: string\n  if (process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n    const { buildRenderer } = require(`../commands/build-html`)\n    pageRenderer = (await buildRenderer(program, Stage.DevelopHTML))\n      .rendererPath\n    const { initDevWorkerPool } = require(`./dev-ssr/render-dev-html`)\n    initDevWorkerPool()\n  } else {\n    indexHTMLActivity.start()\n\n    await createIndexHtml(indexHTMLActivity)\n\n    indexHTMLActivity.end()\n  }\n\n  const devConfig = await webpackConfig(\n    program,\n    directory,\n    Stage.Develop,\n    program.port,\n    {\n      parentSpan: webpackActivity.span,\n    }\n  )\n\n  const compiler = webpack(devConfig)\n\n  /**\n   * Set up the express app.\n   **/\n  app.use(compression())\n  app.use(\n    webpackHotMiddleware(compiler, {\n      log: false,\n      path: `/__webpack_hmr`,\n      heartbeat: 10 * 1000,\n    })\n  )\n\n  app.use(cors())\n\n  /**\n   * Pattern matching all endpoints with graphql or graphiql with 1 or more leading underscores\n   */\n  const graphqlEndpoint = `/_+graphi?ql`\n\n  graphiqlExplorer(app, {\n    graphqlEndpoint,\n    getFragments: function getFragments(): Array<FragmentDefinitionNode> {\n      const fragments: Array<FragmentDefinitionNode> = []\n      for (const def of store.getState().definitions.values()) {\n        if (def.def.kind === Kind.FRAGMENT_DEFINITION) {\n          fragments.push(def.def)\n        }\n      }\n      return fragments\n    },\n  })\n\n  app.use(\n    graphqlEndpoint,\n    createGraphqlEndpointHandler({\n      schema() {\n        return store.getState().schema\n      },\n      context() {\n        return withResolverContext({\n          schema: store.getState().schema,\n          schemaComposer: store.getState().schemaCustomization.composer,\n          context: {},\n          customContext: store.getState().schemaCustomization.context,\n        }) as unknown as OperationContext\n      },\n      onOperation(_req, _args, result) {\n        if (result.errors) {\n          result.errors = result.errors.map(\n            err =>\n              ({\n                ...err.toJSON(),\n                extensions: {\n                  stack: err.stack ? err.stack.split(`\\n`) : [],\n                },\n              } as unknown as GraphQLError)\n          )\n        }\n\n        result.extensions = {\n          enableRefresh: process.env.ENABLE_GATSBY_REFRESH_ENDPOINT,\n          refreshToken: process.env.GATSBY_REFRESH_TOKEN,\n        }\n\n        return result\n      },\n    })\n  )\n\n  /**\n   * Refresh external data sources.\n   * This behavior is disabled by default, but the ENABLE_GATSBY_REFRESH_ENDPOINT env var enables it\n   * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required\n   **/\n  const REFRESH_ENDPOINT = `/__refresh`\n  const refresh = async (\n    req: express.Request,\n    pluginName?: string\n  ): Promise<void> => {\n    global.__GATSBY.buildId = uuid.v4()\n\n    emitter.emit(`WEBHOOK_RECEIVED`, {\n      webhookBody: req.body,\n      pluginName,\n    })\n  }\n\n  app.post(`${REFRESH_ENDPOINT}/:plugin_name?`, express.json(), (req, res) => {\n    const pluginName = req.params[`plugin_name`]\n\n    const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT\n    const refreshToken = process.env.GATSBY_REFRESH_TOKEN\n    const authorizedRefresh =\n      !refreshToken || req.headers.authorization === refreshToken\n\n    if (enableRefresh && authorizedRefresh) {\n      refresh(req, pluginName)\n      res.status(200)\n      res.setHeader(`content-type`, `application/json`)\n    } else {\n      res.status(authorizedRefresh ? 404 : 403)\n      res.json({\n        error: enableRefresh\n          ? `Authorization failed. Make sure you add authorization header to your refresh requests`\n          : `Refresh endpoint is not enabled. Run gatsby with \"ENABLE_GATSBY_REFRESH_ENDPOINT=true\" environment variable set.`,\n        isEnabled: !!process.env.ENABLE_GATSBY_REFRESH_ENDPOINT,\n      })\n    }\n    res.end()\n  })\n\n  app.get(`/__open-stack-frame-in-editor`, (req, res) => {\n    if (req.query.fileName) {\n      const fileName = path.resolve(process.cwd(), req.query.fileName as string)\n      const lineNumber = parseInt(req.query.lineNumber as string, 10)\n      launchEditor(fileName, isNaN(lineNumber) ? 1 : lineNumber)\n    }\n    res.end()\n  })\n\n  addImageRoutes(app, store)\n\n  const webpackDevMiddlewareInstance = webpackDevMiddleware(compiler, {\n    publicPath: devConfig.output.publicPath,\n    stats: `errors-only`,\n    serverSideRender: true,\n  })\n\n  app.use(webpackDevMiddlewareInstance)\n\n  app.get(\n    `/page-data/:pagePath(*)/page-data.json`,\n    async (req, res, next): Promise<void> => {\n      const requestedPagePath = req.params.pagePath\n      if (!requestedPagePath) {\n        next()\n        return\n      }\n\n      const potentialPagePath = reverseFixedPagePath(requestedPagePath)\n      const page = findPageByPath(store.getState(), potentialPagePath, false)\n\n      if (page) {\n        try {\n          let serverDataPromise: Promise<IServerData> | Promise<Error> =\n            Promise.resolve({})\n          const pageMode = getPageMode(page)\n\n          if (pageMode === `SSR`) {\n            const renderer = require(PAGE_RENDERER_PATH)\n            const componentInstance = await renderer.getPageChunk(page)\n\n            serverDataPromise = getServerData(\n              req,\n              page,\n              potentialPagePath,\n              componentInstance\n            ).catch(error => error)\n          }\n\n          let pageData: IPageDataWithQueryResult\n          // TODO move to query-engine\n          if (process.env.GATSBY_QUERY_ON_DEMAND) {\n            pageData = await getPageDataExperimental(page.path)\n          } else {\n            pageData = await readPageData(\n              path.join(store.getState().program.directory, `public`),\n              page.path\n            )\n          }\n\n          let statusCode = 200\n          if (pageMode === `SSR`) {\n            try {\n              const result = await serverDataPromise\n\n              if (result instanceof Error) {\n                throw result\n              }\n\n              if (result.headers) {\n                for (const [name, value] of Object.entries(result.headers)) {\n                  res.setHeader(name, value)\n                }\n              }\n\n              if (result.status) {\n                statusCode = result.status\n              }\n\n              pageData.result.serverData = result.props\n              pageData.getServerDataError = null\n            } catch (error) {\n              const structuredError = report.panicOnBuild({\n                id: `95315`,\n                context: {\n                  sourceMessage: error.message,\n                  pagePath: requestedPagePath,\n                  potentialPagePath,\n                },\n                error,\n              })\n              // Use page-data.json file instead of emitting via websockets as this makes it easier\n              // to only display the relevant error + clearing of the error\n              // The query-result-store reacts to this\n              pageData.getServerDataError = structuredError\n            }\n            pageData.path = page.matchPath ? `/${potentialPagePath}` : page.path\n          } else {\n            // When user removes getServerData function, Gatsby browser runtime still has cached version of page-data.\n            // Send `null` to always reset cached serverData:\n            pageData.result.serverData = null\n          }\n\n          res.status(statusCode).send(pageData)\n          return\n        } catch (e) {\n          report.error(\n            `Error loading a result for the page query in \"${requestedPagePath}\" / \"${potentialPagePath}\". Query was not run and no cached result was found.`,\n            e\n          )\n        }\n      }\n\n      res.status(404).send({\n        path: potentialPagePath,\n      })\n    }\n  )\n\n  app.get(`/__original-stack-frame`, (req, res) => {\n    const emptyResponse = {\n      codeFrame: `No codeFrame could be generated`,\n      sourcePosition: null,\n      sourceContent: null,\n    }\n\n    let sourceContent: string | null\n    let sourceLine: number | undefined\n    let sourceColumn: number | undefined\n    let sourceEndLine: number | undefined\n    let sourceEndColumn: number | undefined\n    let sourcePosition: { line?: number; column?: number } | null\n\n    if (req.query?.skipSourceMap) {\n      if (!req.query?.moduleId) {\n        res.json(emptyResponse)\n        return\n      }\n\n      const absolutePath = path.resolve(\n        store.getState().program.directory,\n        req.query.moduleId as string\n      )\n\n      const compilation: Compilation =\n        res.locals?.webpack?.devMiddleware?.stats?.compilation\n      if (!compilation) {\n        res.json(emptyResponse)\n        return\n      }\n\n      if (!isFileInsideCompilations(absolutePath, compilation)) {\n        res.json(emptyResponse)\n        return\n      }\n\n      try {\n        sourceContent = fs.readFileSync(absolutePath, `utf-8`)\n      } catch (e) {\n        res.json(emptyResponse)\n        return\n      }\n\n      if (req.query?.lineNumber) {\n        try {\n          sourceLine = parseInt(req.query.lineNumber as string, 10)\n\n          if (req.query?.endLineNumber) {\n            sourceEndLine = parseInt(req.query.endLineNumber as string, 10)\n          }\n          if (req.query?.columnNumber) {\n            sourceColumn = parseInt(req.query.columnNumber as string, 10)\n          }\n          if (req.query?.endColumnNumber) {\n            sourceEndColumn = parseInt(req.query.endColumnNumber as string, 10)\n          }\n        } catch {\n          // failed to get line/column, we should still try to show the code frame\n        }\n      }\n      sourcePosition = {\n        line: sourceLine,\n        column: sourceColumn,\n      }\n    } else {\n      const compilation = res.locals?.webpack?.devMiddleware?.stats?.compilation\n      if (!compilation) {\n        res.json(emptyResponse)\n        return\n      }\n\n      const moduleId = req.query?.moduleId\n      const lineNumber = parseInt((req.query?.lineNumber as string) ?? 1, 10)\n      const columnNumber = parseInt(\n        (req.query?.columnNumber as string) ?? 1,\n        10\n      )\n\n      let fileModule\n      for (const module of compilation.modules) {\n        const moduleIdentifier = compilation.chunkGraph.getModuleId(module)\n        if (moduleIdentifier === moduleId) {\n          fileModule = module\n          break\n        }\n      }\n\n      if (!fileModule) {\n        res.json(emptyResponse)\n        return\n      }\n\n      // We need the internal webpack file that is used in the bundle, not the module source.\n      // It doesn't have the correct sourceMap.\n      const webpackSource = compilation?.codeGenerationResults\n        ?.get(fileModule)\n        ?.sources.get(`javascript`)\n\n      const sourceMap = webpackSource?.map()\n\n      if (!sourceMap) {\n        res.json(emptyResponse)\n        return\n      }\n\n      const position = {\n        line: lineNumber,\n        column: columnNumber,\n      }\n      const result = findOriginalSourcePositionAndContent(sourceMap, position)\n\n      sourcePosition = result?.sourcePosition\n      sourceLine = sourcePosition?.line\n      sourceColumn = sourcePosition?.column\n      sourceContent = result?.sourceContent\n\n      if (!sourceContent || !sourceLine) {\n        res.json(emptyResponse)\n        return\n      }\n    }\n\n    const codeFrame = codeFrameColumns(\n      sourceContent,\n      {\n        start: {\n          line: sourceLine ?? 0,\n          column: sourceColumn ?? 0,\n        },\n        end: sourceEndLine\n          ? {\n              line: sourceEndLine,\n              column: sourceEndColumn,\n            }\n          : undefined,\n      },\n      {\n        highlightCode: true,\n      }\n    )\n    res.json({\n      codeFrame,\n      sourcePosition,\n      sourceContent,\n    })\n  })\n\n  app.get(`/__file-code-frame`, async (req, res) => {\n    const emptyResponse = {\n      codeFrame: `No codeFrame could be generated`,\n      sourcePosition: null,\n      sourceContent: null,\n    }\n\n    const filePath: string | undefined = req.query?.filePath as string\n    const lineNumber = parseInt(req.query?.lineNumber as string, 10)\n    const columnNumber = parseInt(req.query?.columnNumber as string, 10)\n\n    if (!filePath) {\n      res.json(emptyResponse)\n      return\n    }\n\n    const absolutePath = path.resolve(\n      store.getState().program.directory,\n      filePath\n    )\n\n    const compilation: Compilation =\n      res.locals?.webpack?.devMiddleware?.stats?.compilation\n    if (!compilation) {\n      res.json(emptyResponse)\n      return\n    }\n\n    if (!isFileInsideCompilations(absolutePath, compilation)) {\n      res.json(emptyResponse)\n      return\n    }\n\n    const sourceContent = await fs.readFile(absolutePath, `utf-8`)\n\n    const codeFrame = codeFrameColumns(\n      sourceContent,\n      {\n        start: {\n          line: lineNumber,\n          column: columnNumber ?? 0,\n        },\n      },\n      {\n        highlightCode: true,\n      }\n    )\n    res.json({\n      codeFrame,\n    })\n  })\n\n  // Expose access to app for advanced use cases\n  const { developMiddleware } = store.getState().config\n\n  if (developMiddleware) {\n    developMiddleware(app)\n  }\n\n  const { proxy, trailingSlash } = store.getState().config\n\n  app.use(configureTrailingSlash(() => store.getState(), trailingSlash))\n\n  // Disable directory indexing i.e. serving index.html from a directory.\n  // This can lead to serving stale html files during development.\n  //\n  // We serve by default an empty index.html that sets up the dev environment.\n  app.use(developStatic(`public`, { index: false }))\n\n  // Set up API proxy.\n  if (proxy) {\n    proxy.forEach(({ prefix, url }) => {\n      app.use(`${prefix}/*`, (req, res) => {\n        const proxiedUrl = url + req.originalUrl\n        const {\n          // remove `host` from copied headers\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          headers: { host, ...headers },\n          method,\n        } = req\n        req\n          .pipe(\n            got\n              .stream(proxiedUrl, {\n                headers,\n                method: method as Method,\n                decompress: false,\n              })\n              .on(`response`, response =>\n                res.writeHead(response.statusCode || 200, response.headers)\n              )\n              .on(`error`, (err, _, response) => {\n                if (response) {\n                  res.writeHead(response.statusCode || 400, response.headers)\n                } else {\n                  const message = `Error when trying to proxy request \"${req.originalUrl}\" to \"${proxiedUrl}\"`\n\n                  report.error(message, err)\n                  res.sendStatus(500)\n                }\n              })\n          )\n          .pipe(res)\n      })\n    }, cors())\n  }\n\n  await apiRunnerNode(`onCreateDevServer`, { app, deferNodeMutation: true })\n\n  // In case nothing before handled hot-update - send 404.\n  // This fixes \"Unexpected token < in JSON at position 0\" runtime\n  // errors after restarting development server and\n  // cause automatic hard refresh in the browser.\n  app.use(/.*\\.hot-update\\.json$/i, (_, res) => {\n    res.status(404).end()\n  })\n\n  // Render an HTML page and serve it.\n  if (process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n    app.get(`*`, async (req, res, next) => {\n      const pathObj = findPageByPath(store.getState(), decodeURI(req.path))\n\n      if (!pathObj) {\n        return next()\n      }\n\n      const allowTimedFallback = !req.headers[`x-gatsby-wait-for-dev-ssr`]\n\n      await appendPreloadHeaders(pathObj.path, res)\n\n      const htmlActivity = report.phantomActivity(`building HTML for path`, {})\n      htmlActivity.start()\n\n      try {\n        const { html: renderResponse, serverData } = await renderDevHTML({\n          path: pathObj.path,\n          page: pathObj,\n          skipSsr: Object.prototype.hasOwnProperty.call(req.query, `skip-ssr`),\n          store,\n          allowTimedFallback,\n          htmlComponentRendererPath: PAGE_RENDERER_PATH,\n          directory: program.directory,\n          req,\n        })\n\n        if (serverData?.headers) {\n          for (const [name, value] of Object.entries(serverData.headers)) {\n            res.setHeader(name, value)\n          }\n        }\n        let statusCode = 200\n        if (serverData?.status) {\n          statusCode = serverData.status\n        }\n        res.status(statusCode).send(renderResponse)\n      } catch (error) {\n        // The page errored but couldn't read the page component.\n        // This is a race condition when a page is deleted but its requested\n        // immediately after before anything can recompile.\n        if (error === `404 page`) {\n          return next()\n        }\n\n        // renderDevHTML throws an error with these information\n        const lineNumber = error?.line as number\n        const columnNumber = error?.column as number\n        const filePath = error?.filename as string\n        const sourceContent = error?.sourceContent as string\n\n        report.error({\n          id: `11614`,\n          context: {\n            path: pathObj.path,\n            filePath: filePath,\n            line: lineNumber,\n            column: columnNumber,\n          },\n        })\n\n        const emptyResponse = {\n          codeFrame: `No codeFrame could be generated`,\n          sourcePosition: null,\n          sourceContent: null,\n        }\n\n        if (!sourceContent || !lineNumber) {\n          res.json(emptyResponse)\n          return null\n        }\n\n        const codeFrame = codeFrameColumns(\n          sourceContent,\n          {\n            start: {\n              line: lineNumber,\n              column: columnNumber ?? 0,\n            },\n          },\n          {\n            highlightCode: true,\n          }\n        )\n\n        const message = {\n          codeFrame,\n          source: filePath,\n          line: lineNumber,\n          column: columnNumber ?? 0,\n          sourceMessage: error?.message,\n          stack: error?.stack,\n        }\n\n        try {\n          // Generate a shell for client-only content -- for the error overlay\n          const { html: clientOnlyShell } = await renderDevHTML({\n            path: pathObj.path,\n            page: pathObj,\n            skipSsr: true,\n            store,\n            error: message,\n            htmlComponentRendererPath: PAGE_RENDERER_PATH,\n            directory: program.directory,\n            req,\n            allowTimedFallback,\n          })\n\n          res.send(clientOnlyShell)\n        } catch (e) {\n          report.error({\n            id: `11616`,\n            context: {\n              sourceMessage: e.message,\n            },\n            filePath: e.filename,\n            location: {\n              start: {\n                line: e.line,\n                column: e.column,\n              },\n            },\n          })\n\n          const minimalHTML = `<head><title>Failed to Server Render (SSR)</title></head><body><h1>Failed to Server Render (SSR)</h1><h2>Error message:</h2><p>${e.message}</p><h2>File:</h2><p>${e.filename}:${e.line}:${e.column}</p><h2>Stack:</h2><pre><code>${e.stack}</code></pre></body>`\n\n          res.send(minimalHTML).status(500)\n        }\n      }\n\n      htmlActivity.end()\n\n      return null\n    })\n  }\n\n  if (\n    process.env.GATSBY_QUERY_ON_DEMAND &&\n    process.env.GATSBY_QUERY_ON_DEMAND_LOADING_INDICATOR === `true`\n  ) {\n    routeLoadingIndicatorRequests(app)\n  }\n\n  app.use(async (req, res) => {\n    // in this catch-all block we don't support POST so we should 404\n    if (req.method === `POST`) {\n      res.status(404).end()\n      return\n    }\n\n    const fullUrl = req.protocol + `://` + req.get(`host`) + req.originalUrl\n    // This isn't used in development.\n    if (fullUrl.endsWith(`app-data.json`)) {\n      res.json({ webpackCompilationHash: `123` })\n      // If this gets here, it's a non-existent file so just send back 404.\n    } else if (fullUrl.endsWith(`.json`)) {\n      res.json({}).status(404)\n    } else {\n      await appendPreloadHeaders(req.path, res)\n\n      if (process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n        try {\n          const allowTimedFallback = !req.headers[`x-gatsby-wait-for-dev-ssr`]\n          const { html: renderResponse } = await renderDevHTML({\n            path: `/dev-404-page/`,\n            // Let renderDevHTML figure it out.\n            page: undefined,\n            store,\n            htmlComponentRendererPath: pageRenderer,\n            directory: program.directory,\n            req,\n            allowTimedFallback,\n          })\n          res.status(404).send(renderResponse)\n        } catch (e) {\n          report.error({\n            id: `11615`,\n            context: {\n              sourceMessage: e.message,\n            },\n            filePath: e.filename,\n            location: {\n              start: {\n                line: e.line,\n                column: e.column,\n              },\n            },\n          })\n          res.send(e).status(500)\n        }\n      } else {\n        const potentialPagePath = reverseFixedPagePath(decodeURI(req.path))\n        const page = findPageByPath(store.getState(), potentialPagePath, false)\n\n        // When we can't find a page we send 404\n        if (!page) {\n          res.status(404)\n        }\n\n        res.sendFile(directoryPath(`.cache/develop-html/index.html`), err => {\n          if (err) {\n            res.status(500).end()\n          }\n        })\n      }\n    }\n  })\n\n  /**\n   * Set up the HTTP server and socket.io.\n   **/\n  const server = program.ssl\n    ? new https.Server(program.ssl, app)\n    : new http.Server(app)\n  const socket = websocketManager.init({ server })\n  const listener = server.listen(program.port, program.host)\n\n  if (!process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n    const chokidar = require(`chokidar`)\n    // Register watcher that rebuilds index.html every time html.js changes.\n    const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path =>\n      slash(directoryPath(path))\n    )\n\n    chokidar.watch(watchGlobs).on(`change`, async () => {\n      await createIndexHtml(indexHTMLActivity)\n      // eslint-disable-next-line no-unused-expressions\n      socket?.to(`clients`).emit(`reload`)\n    })\n  }\n\n  return {\n    compiler,\n    listener,\n    webpackActivity,\n    websocketManager,\n    workerPool,\n    webpackWatching: webpackDevMiddlewareInstance.context\n      .watching as WebpackWatching,\n  }\n}\n"],"mappings":"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"}